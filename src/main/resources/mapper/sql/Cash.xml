<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 관리자 로그인  -->
<mapper namespace="cashSql">
    
    <insert id="insertOrderNo">
        INSERT INTO TCreatePk
        VALUES(#{intOrderNo})    
    </insert>
    
    <!-- 최근 번호 가져오기 -->
    <select id="selectOrderNo" resultType="BigInteger">
        SELECT MAX(PkNo)
        FROM TCreatePk
    </select>
    
    <!-- DB에  결제 결과값 저장 -->
    <insert id="insertPgResult">
        INSERT INTO TCashMst (CashNo, UserNo, PayAmt, CashAmt, PurchaseState
                             ,Tid, Code, Message, UserId, Cid
                             ,Pgcode, TransactionDate, Card_info, Payhash)
                       VALUES(#{intCashNo}, #{intUserNo}, #{amount}, #{intCashAmt}, #{strPurchaseState}
                             ,#{tid}, #{code}, #{message}, #{user_id}, #{cid}
                             ,#{code}, #{transaction_date}, #{card_info}, #{payhash})    
    </insert>

    <!-- 회원 번호 찾기 -->
    <select id="selectUserId" resultType="int">
        SELECT   UserNo   
        FROM TUser
        WHERE UserId = #{id} 
    </select>
    
    <!-- 유저의 기존 보유 캐시 정보 가져오기  -->
    <select id="selectUserCashInfo" resultType="User">
       SELECT TotalCashAmt    AS intTotalCashAmt
             ,TotalInCashAmt  AS intTotalInCashAmt
             ,TotalOutCashAmt AS intTotalOutCashAmt
       FROM TUserCashMst
       WHERE UserNo = #{userNo}
    </select>
    
    <!-- Cash 충전 -->
    <update id="updateUserCashMst">    
		UPDATE TUserCashMst
		SET    TotalInCashAmt = #{intTotalInCashAmt}
		      ,TotalCashAmt = #{intTotalCashAmt}
		WHERE  UserNo = #{intUserNo}
    </update>
    
    <!--충전한 캐시정보 가져오기  -->
    <select id="selectPgCashAmount" resultType="int">
        SELECT CashAmt 
        FROM TCashMst
        WHERE CashNo = #{orderNo}        
    </select>
    
    
</mapper>