<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ##################################################
     # ■ 샘플 Mapper ■ ymkang ■ 2018. 09. 03.
     ################################################### -->
<mapper namespace="sql">
    	
	<!-- 로그인시 아이디 값으로  DB에 있는 정보 가져오기 -->	
	<select id="selectOne"  resultType="User">
		select   UserNo AS intUserNo
				,UserId AS StrUserid
		    	,UserPw AS StrUserPw 	
		from TUser where UserId = #{id} 
	</select>
	
	<!--  -->
	<select id="selectlist"  resultType="User">
		select UserId AS StrUserid
		      ,UserPw AS StrUserPw 		      
		from   TUser
	</select>
	
	<!-- 아이디 중복체크 -->	
	<select id="selectId"  resultType="Member">
		select   UserId AS StrUserid	
		from TUser where UserId = #{id} 
	</select>
	
	<!-- 회원가입 -->	
	<insert id="insertmember" >
		insert into TUser(UserId,UserPw,UserName,UserPhone,UserEmail,UserSex) values(
			#{StrUserId}, #{StrUserPw}, #{StrUserName}, #{StrUserPhone}, #{StrUserEmail}, #{StrUserSex}
			)
	</insert>

	<!-- 마이페이지 -->
	<select id="selectUser"  resultType="User">
		select	 UserId			AS StrUserid
				,UserPw 		AS StrUserPw
				,UserName		AS StrUserName
				,UserPhone 	 	AS StrUserPhone
				,UserEmail   	AS StrUserEmail
				,UserSex   		AS StrUserSex
				,UserDate  		AS DateUserDate
				,UserGrade 		AS StrUserGrade
		from   	 TUser			
		where	 UserId = #{id} 
	</select>
	
	<!--수정한 회원 정보저장 -->
	<select id="updateMember">	
		update	 TUser
		set		 UserPw		= #{StrUserPw}
				,UserName	= #{StrUserName}
				,UserPhone	= #{StrUserPhone}
				,UserEmail	= #{StrUserEmail}
		where	 UserId 	= #{StrUserid} 
	</select>	
	
	<!-- 게시판 목록에 뿌려주기 -->
	<select id="selectboardlist"  resultType="Board">
		SELECT	 BoardNo		AS intBoardNo
				,UserId			AS strUserId
				,BoardTitle 	AS strBoardTitle
				,BoardContent	AS strBoardContent
				,BoardDate 	 	AS dateBoardDate
				,BoardHit   	AS intHit
		FROM   	 TBoard
		ORDER BY BoardNo DESC
	</select>
	
	<!-- 게시판 페이징처리 후 뿌려주기 -->
	<select id="getboardlist"  resultType="Board">
		SELECT TOP 10 resultTable.*
		FROM   (SELECT TOP (10 * #{curPage}) ROW_NUMBER() OVER (ORDER BY BoardNo DESC)    AS rownumber
		                                                                      ,BoardNo    AS intBoardNo
		                                                                      ,UserId     AS strUserId
		                                                                      ,BoardTitle AS strBoardTitle
		                                                                      ,BoardDate  AS dateBoardDate
		                                                                      ,BoardHit   AS intHit
		        FROM TBoard ) AS resultTable
		WHERE rownumber > (#{curPage} - 1) * 10
	 </select>
	 
	 <select id="searchboardlistP"  resultType="Board">        
		SELECT TOP 10 resultTable.*
		FROM   (SELECT TOP (10 * #{curPage}) ROW_NUMBER() OVER (ORDER BY BoardNo DESC)    AS rownumber
		                                                                      ,BoardNo    AS intBoardNo
		                                                                      ,UserId     AS strUserId
		                                                                      ,BoardTitle AS strBoardTitle
		                                                                      ,BoardDate  AS dateBoardDate
		                                                                  	  ,BoardHit   AS intHit
		        FROM (SELECT  *
                      FROM TBoard
                      WHERE ${keyField} LIKE '%${keyWord}%')    AS TSearch ) AS resultTable
        WHERE rownumber > (#{curPage} - 1) * 10
	 </select>
	 
	<!-- 게시글 검색 -->
	<select id="searchboardlist" parameterType="map" resultType="Board">
        SELECT   BoardNo		AS intBoardNo
			    ,UserId			AS strUserId
				,BoardTitle 	AS strBoardTitle
				,BoardContent	AS strBoardContent
				,BoardDate 	 	AS dateBoardDate
				,BoardHit   	AS intHit
        FROM TBoard
        WHERE ${keyField} LIKE '%${keyWord}%'
        ORDER BY BoardNo DESC
    </select>
    
	<!-- 게시글 저장 -->
	<insert id="insertboard" >
		INSERT INTO TBoard(UserId, BoardTitle, BoardContent)
		            VALUES(#{strUserId}, #{strBoardTitle}, #{strBoardContent})
	</insert>
	
	<!-- 게시글 번호를 통해 DB에서 찾아 게시글 읽기 -->
	<select id="boardread" resultType="Board">
		select	 BoardNo		AS intBoardNo
				,UserId			AS strUserId
				,BoardTitle 	AS strBoardTitle
				,BoardContent	AS strBoardContent
				,BoardDate  	AS dateBoardDate
				,BoardHit   	AS intHit
		from   	 TBoard
		where	 BoardNo = #{intBoardNo}
		

	</select>
	
	<!-- 게시글 번호를 통해 DB에서 찾아 게시글 읽기(조회수 증가) -->
	<select id="boardreadHit" resultType="Board">		
		UPDATE	 TBoard 
  		SET		 BoardHit = BoardHit + 1
   		WHERE	 BoardNo  = #{intBoardNo}
   		
   		SELECT	 BoardNo		AS intBoardNo
				,UserId			AS strUserId
				,BoardTitle 	AS strBoardTitle
				,BoardContent	AS strBoardContent
				,BoardDate  	AS dateBoardDate
				,BoardHit   	AS intHit
		FROM   	 TBoard
		WHERE	 BoardNo = #{intBoardNo}
   
	</select>
	
	
	
	<!-- 수정한 게시글 Update -->
	<update id="boardupdate">
		UPDATE	 TBoard
		SET		 BoardTitle   = #{strBoardTitle}
				,BoardContent = #{strBoardContent}
		WHERE	 BoardNo = #{intBoardNo} 
	</update>
	
	<!-- 게시글 삭제 -->
	<delete id="boarddelete">
 		DELETE FROM TBoard
  		WHERE BoardNo 	= #{intBoardNo} 
  		
  		DELETE FROM TComment
  		WHERE BoardNo 	= #{intBoardNo} 
  		
	</delete>
	
	
	
	<!-- 댓글 뿌리기 -->
	<select id="selectcmmtlist"  resultType="Comment">
		SELECT	 CmmtNo			AS intCmmtNo
				,BoardNo		AS intBoardNo
				,UserId			AS strUserId
				,CmmtComment 	AS strCmmtComment
				,CmmtDate		AS dateCmmtDate		
		FROM   	 TComment
		WHERE	 BoardNo = #{intBoardNo}
		ORDER BY CmmtNo	DESC
	</select>
	
	<!-- 댓글 저장 -->
	<insert id="insertcomment" >
		INSERT INTO TComment(BoardNo, UserId, CmmtComment)
		              VALUES(#{intBoardNo}, #{strUserId}, #{strCmmtComment})
	</insert>
	
	<!-- 댓글 수정 -->
	<update id="updatecmmt">
		UPDATE	 TComment
		SET   	 CmmtComment = #{strCmmtComment}
		WHERE	 CmmtNo = #{intCmmtNo}
		
	</update>
	
	<!-- 댓글 삭제 -->
	<delete id="deletecmmt">
 		DELETE  FROM TComment
  		WHERE   CmmtNo = #{intCmmtNo}
	</delete>
	
	<!-- 댓글 찾기 -->
	<select id="commentread" resultType="Comment">
		SELECT	 CmmtNo			AS intCmmtNo
				,BoardNo		AS intBoardNo
				,CmmtComment 	AS strCmmtComment
		FROM   	 TComment
		WHERE	 CmmtNo = #{intCmmtNo}
	</select>
	
	<!--  댓글수 -->
	<select id="totalComment" resultType="int">
		SELECT    count(*)
		FROM      TComment
		WHERE     BoardNo = #{intBoardNo}	
	</select>
	
	<!-- 아이디로 등급 가져오기 -->
	<select id="getUserGrade" resultType="String">
		SELECT    UserGrade
		FROM      TUser			
		WHERE     UserId = #{id} 
	
	</select>
</mapper>
