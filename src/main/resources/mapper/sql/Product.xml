<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 관리자 로그인  -->
<mapper namespace="productSql">

    <!-- 상품등록-->   
    <insert id="insertProduct">
        INSERT INTO TItemInfoMgmt(ItemName, ItemPrice, AdminNo, FileName, FileUrl  ,FileOriName)
                           VALUES( #{strItemName}, #{intItemPrice}, #{intAdminNo}, #{strfileName}, #{strfileUrl}, #{strfileOriName})
    </insert>

    <!-- DB에서 모든 상품 리스트 가져오기 -->
    <select id="seletAllList" resultType="ProductInfo">
        SELECT  ItemNo        AS  intItemNo
               ,ItemName      AS  strItemName
               ,ItemPrice     AS  intItemPrice
               ,ItemDate      AS  dateItemDate
               ,AdminId       AS  strAdminId
               ,UpdateItemDate AS  dateUpdateItemDateo
        FROM    TItemInfoMgmt   INNER JOIN   TAdmin
        ON TItemInfoMgmt.AdminNo = TAdmin.AdminNo
        ORDER BY ItemDate DESC
    </select>
    
    <!-- 수정한 관리자 이름 가져오기 -->
    <select id="selectAdminName" resultType="String">
        SELECT  AdminName
        FROM    TAdmin
        WHERE   AdminNo = #{updateNo}
    </select>

    <!-- 상품삭제-->
    <delete id="deleteProduct">
        DELETE FROM TItemInfoMgmt
        WHERE ItemNo = #{itemNo}
    </delete>
    
    <!-- 아이템 전체 리스트 -->
    <select id="selectAllItemList" resultType="ProductInfo">
        SELECT  ItemNo        AS  intItemNo
               ,ItemName      AS  strItemName
               ,ItemPrice     AS  intItemPrice
               ,FileUrl       AS  strfileUrl
        FROM    TItemInfoMgmt   
        WHERE   ItemNo NOT IN(0)  
        ORDER BY ItemDate DESC
    </select>
    
     <!-- 아이템 전체 리스트 -->
    <select id="selectAllItem" resultType="ProductInfo">
        SELECT TOP 12 resultTable.*
        FROM   (SELECT TOP (12 * #{curPage}) ROW_NUMBER() OVER (ORDER BY ItemDate DESC)    AS rownumber
                                                                           ,ItemNo        AS  intItemNo
															               ,ItemName      AS  strItemName
															               ,ItemPrice     AS  intItemPrice
															               ,FileUrl       AS  strfileUrl
		        FROM    TItemInfoMgmt   
		        WHERE   ItemNo NOT IN(0)  ) AS resultTable
        WHERE rownumber > (#{curPage} - 1) * 10
    </select>
    
    <!-- 검색시 아이템 개수 -->
    <select id="countItemList" resultType="ProductInfo">
        SELECT  ItemNo        AS  intItemNo
               ,ItemName      AS  strItemName
               ,ItemPrice     AS  intItemPrice
               ,FileUrl       AS  strfileUrl
        FROM    TItemInfoMgmt   
        WHERE   ItemNo NOT IN(0) AND ${keyField} LIKE '%${keyWord}%'
    </select>
    
    <!-- 검색시 아이템 전체 목록 개수 -->
    <select id="selectAllItemSearch" resultType="ProductInfo">
        SELECT TOP 12 resultTable.*
        FROM   (SELECT TOP (12 * #{curPage}) ROW_NUMBER() OVER (ORDER BY ItemDate DESC)    AS rownumber
                                                                           ,ItemNo        AS  intItemNo
                                                                           ,ItemName      AS  strItemName
                                                                           ,ItemPrice     AS  intItemPrice
                                                                           ,FileUrl       AS  strfileUrl
		        FROM   (SELECT *  
				        FROM TItemInfoMgmt
				        WHERE ${keyField} LIKE '%${keyWord}%')  AS TSearch  
		        WHERE   ItemNo NOT IN(0)  ) AS resultTable
        WHERE rownumber > (#{curPage} - 1) * 10
    </select>
    
     <!-- 검색시 아이템 개수 -->
    <select id="selectItemInfo" resultType="ItemShopInfo">
        SELECT  ItemNo        AS  intItemNo
               ,ItemName      AS  strItemName
               ,ItemPrice     AS  intItemPrice
               ,FileUrl       AS  strfileUrl
        FROM    TItemInfoMgmt   
        WHERE   ItemNo = #{itemNo}
    </select>
    
    <!-- 회원 정보 불러오기 -->
    <select id="selectMemberInfo" resultType="User">
        SELECT   UserNo       AS intUserNo
		        ,UserName     AS strUserName
		        ,UserPhone    AS strUserPhone
		        ,UserPostCode AS strPostCode
		        ,UserAdress   AS strAdress
		        ,UserAdress2  AS strAdress2
		FROM TUser
		WHERE UserNo = 2
    </select>
</mapper>