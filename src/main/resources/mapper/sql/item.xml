<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 관리자 로그인  -->
<mapper namespace="itemSql">

    <!-- 캐시 회수 번호 가져오기 -->
    <select id="selectRecallItemNo" resultType="int">
        SELECT  ItemNo
        FROM    TItemInfoMgmt
        WHERE   ItemName = #{recallItemName}
    </select>
    
    <!-- 아이템 구매 테이블 insert -->
    <insert id="insertItemPurchaseRecall">
        INSERT INTO TItemPurchaseMst( PurchaseNo, ItemNo, UserNo, ItemPrice, ItemCount
                                    , TotalItemPrice, AdminNo)
                              VALUES( #{intNumber}, #{intItemNo}, #{intUserNo}, #{intAmount}, #{intItemCount} 
                                     ,#{intTotalPrice}, #{intAdminNo})
                    
    </insert>
    
    <!-- remaincash가 있는 리스트 가져오기 -->
    <select id="selectCashAllList" resultType="CashInfo">
        SELECT CashNo           AS intCashNo
              ,RemainCashAmt    AS intRemainCash
		FROM TCashMst
		WHERE UserNo = #{userNo} AND RemainCashAmt NOT IN(0)
    </select>
    
    <!-- 구매 매핑테이블에 insert -->
    <insert id="insertRecallMapping">
        INSERT INTO TCashUsedDtl(UserNo, CashNo, PurchaseNo, RemainCashAmt)
        VALUES (#{intUserNo}, #{intCashNo}, #{intPurchaseNo}, #{intRemainCash})
                   
    </insert>
    
    <!-- 남은돈 update -->
    <update id="updateCashRemain">
	    UPDATE TCashMst
		SET RemainCashAmt = #{intRemainCash}
		WHERE UserNo = #{intUserNo} AND CashNo = #{intCashNo}
    
    </update>
    
</mapper>