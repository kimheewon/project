<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 관리자 로그인  -->
<mapper namespace="itemSql">

    <!-- 캐시 회수 번호 가져오기 -->
    <select id="selectRecallItemNo" resultType="int">
        SELECT  ItemNo
        FROM    TItemInfoMgmt
        WHERE   ItemName = #{recallItemName}
    </select>
    
    <!-- 아이템 구매 테이블 insert -->
    <insert id="insertItemPurchaseRecall">
        INSERT INTO TItemPurchaseMst( PurchaseNo, ItemNo, UserNo, ItemPrice, ItemCount
                                     ,TotalItemPrice, AdminNo)
                              VALUES( #{intNumber}, #{intItemNo}, #{intUserNo}, #{intAmount}, #{intItemCount} 
                                     ,#{intTotalPrice}, #{intAdminNo})
                    
    </insert>
    
    <!-- remaincash가 있는 리스트 가져오기 -->
    <select id="selectCashAllList" resultType="CashInfo">
        SELECT CashNo           AS intCashNo
              ,RemainCashAmt    AS intRemainCash
		FROM TCashMst
		WHERE UserNo = #{userNo} AND RemainCashAmt NOT IN(0)
    </select>
    
    <!-- 구매 매핑테이블에 insert -->
    <insert id="insertRecallMapping">
        INSERT INTO TCashUsedDtl(UserNo, CashNo, PurchaseNo, RemainCashAmt)
        VALUES (#{intUserNo}, #{intCashNo}, #{intPurchaseNo}, #{intRemainCash})
                   
    </insert>
    
    <!-- 남은돈 update -->
    <update id="updateCashRemain">
	    UPDATE TCashMst
		SET RemainCashAmt = #{intRemainCash}
		WHERE UserNo = #{intUserNo} AND CashNo = #{intCashNo}
    
    </update>
    
    <!-- 아이템구매(아이템 구매 테이블에 insert) -->
    <insert id="insertItemPurchase">
        INSERT INTO TItemPurchaseMst(PurchaseNo, ItemNo, UserNo, ItemPrice, ItemCount
                                    ,TotalItemPrice, DeliveryPrice)
                              VALUES(#{intNumber}, #{itemNo}, #{intUserNo}, #{intItemPrice}, #{itemCount}
                                    ,#{intItemTotalPrice}, #{intDeliveryPrice} )
    </insert>
    
    <!-- 배송정보 insert -->
    <insert id="insertDeliveryInfo">
    INSERT INTO TDeliveryInfoMst(PurchaseNo, UserNo, UserPhone, UserPostCode, UserAdress
                                ,UserAdress2, RequestMsg,UserName)
                          VALUES(#{intNumber}, #{intUserNo}, #{strTel}, #{strPostcode}, #{strAddress}
                                ,#{strAddress2}, #{strDeliverMsg}, #{strName})
    </insert>
    
    <!-- 구매한 아이템 정보 가져오기 -->
    <select id="selectPurchaseItem" resultType="ItemShopInfo">
        SELECT   ItemNo           AS intItemNo
		        ,ItemPrice        AS intItemPrice
		        ,ItemCount        AS itemCount
		        ,TotalItemPrice   AS intItemTotalPrice
		        ,DeliveryPrice    AS intDeliveryPrice
		FROM  TItemPurchaseMst
		WHERE PurchaseNo = #{purchaseNo}
    </select>
    
    <!-- 배송정보 가져오기 -->
    <select id="selectDeliveryInfo" resultType="ItemShopInfo">
        SELECT   UserName       AS strName
                ,UserPhone      AS strTel
		        ,UserPostCode   AS strPostcode
		        ,UserAdress     AS strAddress
		        ,UserAdress2    AS strAddress2
		        ,RequestMsg     AS strDeliverMsg
		FROM TDeliveryInfoMst
		WHERE PurchaseNo = #{purchaseNo}
    </select>
</mapper>